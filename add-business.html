<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Businessio â€¢ Add Business</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f4f6ff;padding:15px;}
h2{text-align:center;color:#1f4cff;}
form{max-width:500px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,.1);}
label{display:block;margin-top:10px;font-weight:bold;}
input,select,textarea{width:100%;padding:10px;margin-top:5px;border-radius:8px;border:1px solid #ccc;}
button{margin-top:15px;padding:12px;border:none;border-radius:8px;background:#1f4cff;color:#fff;font-size:16px;cursor:pointer;width:100%;}
</style>
</head>
<body>

<h2>Add Your Business/Product</h2>

<form id="businessForm">
  <label for="type">Type</label>
  <select id="type" required>
    <option value="">Select type</option>
    <option value="product">Product</option>
    <option value="job">Job Offer</option>
  </select>

  <label for="name">Business / Product Name</label>
  <input type="text" id="name" required>

  <label for="country">Country</label>
  <select id="country" required>
    <option value="">Select country</option>
    <option value="Nigeria">Nigeria</option>
  </select>

  <label for="state">State</label>
  <input type="text" id="state" placeholder="Enter state" required>

  <label for="location">Location</label>
  <input type="text" id="location" placeholder="Street or area" required>

  <label for="description">Description</label>
  <textarea id="description" rows="4" placeholder="Describe your business or product"></textarea>

  <div id="ageFields" style="display:none;">
    <label>Minimum Age</label>
    <input type="number" id="minAge" min="0">
    <label>Maximum Age</label>
    <input type="number" id="maxAge" min="0">
  </div>

  <label for="photo">Photo URL</label>
  <input type="text" id="photo" placeholder="Optional: link to image">

  <button type="submit">Add Business</button>
</form>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDeFlOeRoiNjqH9LAclnqnehXNY6scPqzE",
  authDomain: "businessio-37c69.firebaseapp.com",
  projectId: "businessio-37c69"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;
onAuthStateChanged(auth,user=>{
  if(!user) location.href="index.html";
  currentUser = user;
});

// Show age fields only for Job Offer
const typeSelect = document.getElementById("type");
const ageFields = document.getElementById("ageFields");
typeSelect.addEventListener("change",()=>{
  ageFields.style.display = typeSelect.value==="job"?"block":"none";
});

// Form submit
document.getElementById("businessForm").addEventListener("submit", async e=>{
  e.preventDefault();
  if(!currentUser) return;

  const data = {
    type:typeSelect.value,
    name: document.getElementById("name").value.trim(),
    country: document.getElementById("country").value,
    state: document.getElementById("state").value.trim(),
    location: document.getElementById("location").value.trim(),
    description: document.getElementById("description").value.trim(),
    photo: document.getElementById("photo").value.trim() || "",
    userId: currentUser.uid,
    created: Date.now()
  };

  if(typeSelect.value==="job"){
    data.minAge = parseInt(document.getElementById("minAge").value) || 0;
    data.maxAge = parseInt(document.getElementById("maxAge").value) || 0;
  }

  try{
    await addDoc(collection(db,"businesses"),data);
    alert("Business added successfully!");
    document.getElementById("businessForm").reset();
    ageFields.style.display="none";
  }catch(err){
    console.error(err);
    alert("Error adding business. Check console.");
  }
});
</script>

</body>
</html>
