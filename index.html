<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Businessio â€¢ Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#1f4cff,#4f46e5);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card{
  background:#fff;
  width:100%;
  max-width:420px;
  border-radius:14px;
  padding:25px;
  box-shadow:0 20px 40px rgba(0,0,0,.15);
}
h2{text-align:center;margin-top:0}
input,textarea{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ddd;
}
button{
  width:100%;
  padding:12px;
  margin-top:15px;
  border:none;
  border-radius:8px;
  background:#1f4cff;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}
button.secondary{
  background:#eef2ff;
  color:#1f4cff;
}
.profile{
  text-align:center;
}
.profile img{
  width:80px;
  height:80px;
  border-radius:50%;
  object-fit:cover;
  border:3px solid #1f4cff;
}
.hidden{display:none}
small{color:#666}
</style>
</head>

<body>

<div class="card">

<!-- LOGIN / SIGNUP -->
<div id="authBox">
  <h2>Businessio</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <input id="name" placeholder="Full Name (signup only)">
  <textarea id="bio" placeholder="Short bio (signup only)"></textarea>
  <button onclick="signup()">Sign Up</button>
  <button class="secondary" onclick="login()">Login</button>
</div>

<!-- PROFILE -->
<div id="profileBox" class="profile hidden">
  <img id="avatar" src="https://via.placeholder.com/100">
  <h3 id="pName"></h3>
  <p id="pBio"></p>
  <small id="pEmail"></small>
  <button onclick="goDashboard()">Go to Dashboard</button>
  <button class="secondary" onclick="logout()">Logout</button>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDeFlOeRoiNjqH9LAclnqnehXNY6scPqzE",
  authDomain: "businessio-37c69.firebaseapp.com",
  projectId: "businessio-37c69"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* AUTH STATE */
onAuthStateChanged(auth, async (user)=>{
  if(user){
    const snap = await getDoc(doc(db,"users",user.uid));
    if(snap.exists()){
      const u = snap.data();
      authBox.classList.add("hidden");
      profileBox.classList.remove("hidden");
      pName.innerText = u.name;
      pBio.innerText = u.bio;
      pEmail.innerText = user.email;
      if(u.photo) avatar.src = u.photo;
    }
  }
});

/* SIGNUP */
window.signup = async ()=>{
  if(!email.value || !password.value || !name.value){
    alert("Fill all required fields");
    return;
  }
  const cred = await createUserWithEmailAndPassword(auth,email.value,password.value);
  await setDoc(doc(db,"users",cred.user.uid),{
    name:name.value,
    bio:bio.value || "",
    photo:"",
    created:Date.now()
  });
};

/* LOGIN */
window.login = async ()=>{
  await signInWithEmailAndPassword(auth,email.value,password.value);
};

/* LOGOUT */
window.logout = async ()=>{
  await signOut(auth);
  location.reload();
};

/* DASHBOARD */
window.goDashboard = ()=>{
  location.href="dashboard.html";
};
</script>

</body>
</html>
