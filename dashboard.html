<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard â€¢ Businessio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#f4f6fb;}
header{background:#1f4cff;color:#fff;padding:15px;text-align:center;font-size:20px;font-weight:bold}
.container{padding:20px;max-width:900px;margin:auto}
.profile{display:flex;align-items:center;margin-bottom:20px}
.profile img{width:80px;height:80px;border-radius:50%;margin-right:15px;object-fit:cover;border:2px solid #1f4cff}
.profile div{flex:1}
h3{margin:5px 0;color:#1f4cff}
.user-info{margin-bottom:25px}
button{padding:8px 12px;border:none;border-radius:8px;background:#1f4cff;color:#fff;cursor:pointer;margin-right:10px}
button:hover{background:#1636d0}
.section{background:#fff;padding:15px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,.1);margin-bottom:20px}
.section h4{margin-top:0;color:#1f4cff}
.item{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #eee}
.item:last-child{border-bottom:none}
.nav{margin-bottom:20px}
.nav a{margin-right:15px;color:#1f4cff;text-decoration:none;font-weight:bold}
.nav a:hover{text-decoration:underline}
</style>
</head>

<body>

<header>Businessio Dashboard</header>

<div class="container">
  <div class="profile">
    <img id="profilePic" src="https://via.placeholder.com/80" alt="Profile Picture">
    <div>
      <h3 id="userName">Loading...</h3>
      <p id="userEmail"></p>
      <p id="userAge"></p>
    </div>
  </div>

  <div class="nav">
    <a href="upload-business.html">Upload Business</a>
    <a href="upload-job.html">Post Job</a>
    <a href="logout.html">Logout</a>
  </div>

  <div class="section">
    <h4>Your Businesses</h4>
    <div id="businessList">Loading...</div>
  </div>

  <div class="section">
    <h4>Your Jobs</h4>
    <div id="jobList">Loading...</div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyDeFlOeRoiNjqH9LAclnqnehXNY6scPqzE",
  authDomain:"businessio-37c69.firebaseapp.com",
  projectId:"businessio-37c69"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

const userName = document.getElementById("userName");
const userEmail = document.getElementById("userEmail");
const userAge = document.getElementById("userAge");
const profilePic = document.getElementById("profilePic");

const businessList = document.getElementById("businessList");
const jobList = document.getElementById("jobList");

// Check if user is logged in
onAuthStateChanged(auth, async(user)=>{
  if(!user){
    window.location.href="login.html";
    return;
  }

  const uid = user.uid;

  // Load user info from Firestore
  const userDoc = await getDocs(query(collection(db,"users"),where("__name__","==",uid)));
  if(!userDoc.empty){
    const data = userDoc.docs[0].data();
    userName.innerText = data.name;
    userEmail.innerText = data.email;
    userAge.innerText = "Age: "+data.age;
    if(data.profilePic) profilePic.src = data.profilePic;
  }

  // Load user businesses
  const bizQuery = query(collection(db,"businesses"),where("ownerId","==",uid));
  const bizSnap = await getDocs(bizQuery);
  if(bizSnap.empty){
    businessList.innerHTML = "<p>No businesses posted yet.</p>";
  }else{
    businessList.innerHTML = "";
    bizSnap.forEach(doc=>{
      const biz = doc.data();
      businessList.innerHTML += `<div class="item">
        <span>${biz.name}</span>
        <span>
          <button onclick="editBusiness('${doc.id}')">Edit</button>
          <button onclick="deleteBusiness('${doc.id}')">Delete</button>
        </span>
      </div>`;
    });
  }

  // Load user jobs
  const jobQuery = query(collection(db,"jobs"),where("ownerId","==",uid));
  const jobSnap = await getDocs(jobQuery);
  if(jobSnap.empty){
    jobList.innerHTML = "<p>No jobs posted yet.</p>";
  }else{
    jobList.innerHTML = "";
    jobSnap.forEach(doc=>{
      const job = doc.data();
      jobList.innerHTML += `<div class="item">
        <span>${job.title}</span>
        <span>
          <button onclick="editJob('${doc.id}')">Edit</button>
          <button onclick="deleteJob('${doc.id}')">Delete</button>
        </span>
      </div>`;
    });
  }
});

// Placeholder functions for editing/deleting
window.editBusiness = (id)=>{ alert("Edit business: "+id); }
window.deleteBusiness = (id)=>{ alert("Delete business: "+id); }
window.editJob = (id)=>{ alert("Edit job: "+id); }
window.deleteJob = (id)=>{ alert("Delete job: "+id); }
</script>

</body>
</html>
